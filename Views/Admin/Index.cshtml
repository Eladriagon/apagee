@using Microsoft.AspNetCore.SignalR.Protocol
@model DashboardViewModel

<h1 class="title is-2">Dashboard</h1>

<section class="section">
    <div class="block">
        <h2 class="subtitle is-4 has-text-centered">Post Stats</h2>
    </div>

    <div class="level">
        <div class="level-item has-text-centered">
            <div>
                <p class="title is-1">@Model.FollowerCount</p>
                <p class="heading">follower@(@Model.FollowerCount == 1 ? "" : "s")</p>
            </div>
        </div>
        <div class="level-item has-text-centered">
            <div>
                <p class="title is-1">@Model.PostCount</p>
                <p class="heading">article@(@Model.PostCount == 1 ? "" : "s")</p>
            </div>
        </div>
        <div class="level-item has-text-centered">
            <div>
                <p class="title is-1">@Model.BoostCount</p>
                <p class="heading">boost@(@Model.BoostCount == 1 ? "" : "s")</p>
            </div>
        </div>
        <div class="level-item has-text-centered">
            <div>
                <p class="title is-1">@Model.FavoriteCount</p>
                <p class="heading">favorite@(@Model.FavoriteCount == 1 ? "" : "s")</p>
            </div>
        </div>
    </div>
</section>

<section class="section">

    <div class="block">
        <h2 class="subtitle is-4">Recent Posts</h2>
    </div>

    <table class="table is-fullwidth">
        <thead>
            <tr>
                <th></th>
                <th>Post</th>
                <th>Drafted</th>
                <th>Published</th>
                <th>Stats</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.RecentArticles is null || !Model.RecentArticles.Articles.Any())
            {
                <tr>
                    <td colspan="4" class="has-text-centered pt-5">
                        <p><em>No articles found! Why not <a asp-action="NewArticle">write one now</a>?</em></p>
                        <p class="pt-3"><i class="e is-size-2">ðŸ˜¢</i></p>
                    </td>
                </tr>
            }
            else
            {
                @foreach (var article in Model.RecentArticles.Articles)
                {
                    <tr class="is-vertical-align-middle">
                        <td>
                            <a asp-action="EditArticle" asp-route-id="@article.Article.Uid" title="Edit" class="button is-vertical-align-middle is-small is-dark is-warning">
                                <span class="icon">
                                    <i class="fas fa-pencil"></i>
                                </span>
                            </a>
                        </td>
                        <td class="has-truncated-title">
                            @if (article.Article.PublishedOn is not null)
                            {
                                <a title="@article.Article.Title" class="article-title-truncated" href="/@article.Article.Slug" target="_blank">@article.Article.Title</a>
                            }
                            else
                            {
                                <a title="@article.Article.Title" class="article-title-truncated" href="/preview/@article.Article.Uid" target="_blank">@article.Article.Title</a>
                            }
                        </td>
                        <td><partial name="DateDisplay" model="@(((DateTime?)article.Article.CreatedOn, false))" /></td>
                        <td><partial name="DateDisplay" model="@((article.Article.PublishedOn, false))" /></td>
                        <td>
                            <div class="field is-grouped is-grouped-multiline">
                                <div class="control">
                                    <span class="tags has-addons has-text-weight-semibold">
                                        <span class="tag is-warning">
                                            <span class="icon">
                                                <i class="fas fa-star"></i>
                                            </span>
                                        </span>
                                        <span class="tag is-dark">@(article.Likes?.ToString("#,#0") ?? "0")</span>
                                    </span>
                                </div>
                                <div class="control">
                                    <span class="tags has-addons is-info has-text-weight-semibold">
                                        <span class="tag is-info">
                                            <span class="icon">
                                                <i class="fas fa-retweet"></i>
                                            </span>
                                        </span>
                                        <span class="tag is-dark">@article.Shares?.ToString("#,#0" ?? "0")</span>
                                    </span>
                                </div>
                            </div>
                        </td>
                    </tr>
                }
            }
            </thead>
    </table>
</section>